# Настройка безопасности в системе

## Инициализация
При первичной настройке безопасности надо выполнить следующее:
* Синхронизировать права, чтобы права, заведенные через утилиту acl, появились в админке. Для этого на странице `/ionadmin/security/sync` жмем кнопку **"Синхронизация прав доступа"**. По завершении будет сообщение *"Синхронизация прав доступа успешно проведена!"*.
* Сделать импорт ресурсов. Если на странице `/ionadmin/security/resource` нет объектов или их действительно мало, тогда надо выполнить импорт ресурсов. Выполняется на странице `/ionadmin/security/sync` по кнопке **"Импорт ресурсов"**. По завершении будет сообщение *"Импорт успешно завершен!"*.

## Управление ролями доступа

### Создание роли
На странице `/ionadmin/security/role` можно создавать, редактировать или удалять роли. Для создания роли на странице `/ionadmin/security/role` нажимаем кнопку **"Создать"**, происходит переход на новую страницу, где надо указать идентификатор роли на английском языке. Нажимаем на кнопку **"Сохранить"** для подтверждения создания указанной роли.

Для редактирования роли на странице `/ionadmin/security/role` выбираем необходимую роль и нажимаем кнопку **"Править"**, происходит переход на новую страницу, где на форме отображаются следующие поля:
* *Идентификатор* - выражение на английском языке для присваивания уникального имени роли. При ее изменении могут слететь права у пользователей, которые ранее привязали данную роль со старым идентификатором. Надо тогда каждому пользователю привязать роль заново.
* *Название* - осмысленное название роли, может содержать выражения на русском языке.
* *Права доступа* - вкладки для раздачи прав.

Для удаления роли на странице `/ionadmin/security/role` выбираем необходимую роль и нажимаем кнопку **"Удалить"**

### Настройка прав доступа

Разделы прав доступа:
* *Общие* - пока используется для раздачи роли доступа ко всем ресурсам (* - все ресурсы)
* *Навигация* - используется для раздачи роли доступа к меню модуля регистра. Сначала отображается системное наименование проекта, у которого есть знак плюса для отображения внутренних и импортированных ресурсов. Раздаются в данном пункте пока только права на чтение меню.
* *Классы* - используется для раздачи роли доступа к классам метаданных. Сначала отображается системное наименование проекта, у которого есть знак плюса для отображения внутренних и импортированных ресурсов. У этих ресурсов можно задать отдельные права по каждому ресурсу.

При управлении ролями в правах доступа предоставляются следующие доступы к каждому ресурсу:

|Доступ |Описание доступа |
|------------|-----------|
| Полный доступ| Включает в себя все остальные  доступы. Нельзя выбрать полный доступ и еще дополнительный доступ на чтение, запись, удаление или использование. Для навигации предоставляется доступ только на чтение ресурса.|
|Чтение | Возможность чтение объектов ресурса|
|Запись |Возможность редактирования объектов ресурса, не применяется для навигации |
| Удаление| Возможность удаления объектов ресурса, не применяется для навигации|
|Использование | Возможность создания объектов ресурса, не применяется для навигации|


Доступ может назначаться всей группе ресурсов или отдельными галками по каждому ресурсе и доступу в нем.

### Управление пользователями

На странице `/ionadmin/security/user` можно создавать, редактировать или удалять пользователей. Для создания пользователя на странице `/ionadmin/security/user` нажимаем кнопку **"Создать"**, происходит переход на новую страницу, где надо указать логин пользователя на английском языке, пароль, описание в имени. Нажимаем на кнопку **"Сохранить"** для подтверждения создания указанного пользователя. Для редактирования пользователя на странице `/ionadmin/security/user` выбираем необходимого пользователя и нажимаем кнопку **"Править"**, происходит переход на новую страницу, где на форме отображаются следующие поля:
* *Тип* - тип учетной записи пользователя, пока доступны в админке локальные пользователи.
* *Логин* - идентификатор пользователя на английском языке.
* *Пароль* - пароль пользователя.
* *Имя* - осмысленное название пользователя, может содержать выражения на русском языке, например, *Фамилия И.О.*
* *Роли* - список ролей пользователя. Если проставлена галка у роли, то роль привязана к пользователю.

Для удаления пользователя на странице `/ionadmin/security/user` выбираем необходимого пользователя и нажимаем кнопку **"Удалить"**, после подтверждаем удаление пользователя.

Для корректной работы с модулем необходимо выполнить следующие настройки в файле *config/config.json*:

#### Настройка записи в БД интервалов

Настройка в виде модального окна на списке медленных запросов.
В в файле config.json модуля ionadmin указывать источник:

```json
"profiling": {
    "slowQuery": {
      "sources": [
          {
            "collection": "system.profile"
          }
      ]
    }
  }
```
Если свойство `"sources"` не задано или null, то будет браться из таблицы:
```json
{ 
  "profiling": {
    "slowQuery": {
      "sources": null
    }
  }
}
```
Если задан пустой массив, то источников нет.

#### Настройка источников логов

Источники логов (может быть несколько) указываются в файле config.json модуля:
```json
"profiling": {
    "slowQuery": {
      "sources": [
        {
          "collection": "system.profile"
        },
        {
          "file": "D:/Temp/slow-query.txt"
        }
      ]
    }
  }
```
Сделанные выборки хранятся в отдельной таблице и не зависят от текущего состояния источников логов. Их можно дополнить редактированием. Например, комментариями или пометками решена проблема или нет.

#### Настройка резервирования БД

Настройка в файле config.json:
```javascript
"backup": {
    "dir": "../ion-backups", //содержит путь папки, в которой было запущено приложение ноды. По умолчанию "../ion-backups"
    "zlib": {
      "level": 1 //уровень сжатия, также влияет на скорость создания архива. По умолчанию - значение 3
    }
  }
```
К тому же необходимо что бы утилита `export.js` с заданными параметрами корректно отрабатывала сама по себе.